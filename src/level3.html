<!DOCTYPE html>
<html lang="ta">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Level 3 — Crossword Hunt (Neon, Clean)</title>

    <!-- ======= CSS (Styles) ======= -->
    <style>
      :root {
        --bg-dark-1: #050510;
        --bg-dark-2: #0c0d1a;
        --card: #0e1624;
        --neon-purple: 106, 92, 255;
        --neon-pink: 255, 107, 129;
        --neon-teal: 0, 224, 184;
        --glass: rgba(255, 255, 255, 0.03);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Baloo 2", "Baloo Chettan 2", system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
      }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 14px;
        padding: 18px;
        color: #e6f7f1;
        background: radial-gradient(
            800px 400px at 10% 10%,
            rgba(106, 92, 255, 0.06),
            transparent
          ),
          radial-gradient(
            700px 350px at 90% 85%,
            rgba(0, 224, 184, 0.04),
            transparent
          ),
          linear-gradient(180deg, var(--bg-dark-1), var(--bg-dark-2));
        overflow: hidden;
      }

      .bg-canvas {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
      }
      .grain {
        position: fixed;
        inset: 0;
        z-index: 0;
        opacity: 0.035;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><rect width="100%" height="100%" fill="%23000000" /><circle cx="2" cy="2" r="1" fill="%23ffffff" /></svg>');
        mix-blend-mode: overlay;
        pointer-events: none;
      }

      header {
        width: 100%;
        max-width: 1100px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 18px;
        border-radius: 12px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(6px);
        z-index: 2;
      }
      header .left {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      header h1 {
        margin: 0;
        font-size: 1.25rem;
        color: rgba(200, 170, 255, 0.98);
        font-weight: 900;
      }
      header .subtitle {
        color: #bfeee0;
        font-size: 0.95rem;
        opacity: 0.95;
      }

      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
        z-index: 2;
      }
      .counter {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--glass);
        padding: 8px 10px;
        border-radius: 999px;
      }
      .counter button {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        font-size: 18px;
        background: linear-gradient(180deg, #222538, #11121b);
        color: #fff;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
      }
      .counter .value {
        min-width: 40px;
        text-align: center;
        font-size: 1.1rem;
        font-weight: 900;
        color: rgb(var(--neon-teal));
      }

      .check-btn {
        background: linear-gradient(
          90deg,
          rgba(106, 92, 255, 0.95),
          rgba(255, 107, 129, 0.95)
        );
        border: none;
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        color: #fff;
        font-weight: 900;
        box-shadow: 0 12px 40px rgba(100, 50, 200, 0.16);
        transform-origin: center;
        transition: transform 0.14s ease;
      }
      .check-btn:active {
        transform: scale(0.98);
      }

      .stage {
        width: 100%;
        max-width: 1100px;
        display: flex;
        gap: 18px;
        align-items: flex-start;
        justify-content: center;
        padding: 10px;
        z-index: 1;
      }
      .grid-card {
        width: 560px;
        height: 560px;
        padding: 18px;
        border-radius: 14px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.012),
          rgba(255, 255, 255, 0.006)
        );
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        display: grid;
        place-items: center;
        position: relative;
      }

      .grid {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-auto-rows: 1fr;
        gap: 10px;
        padding: 8px;
      }
      .cell {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        overflow: visible;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.08)
        );
        color: #eaf7f1;
        font-weight: 900;
        font-size: 1.25rem;
        cursor: default;
        user-select: none;
        transition: transform 0.12s cubic-bezier(0.2, 0.9, 0.2, 1),
          box-shadow 0.12s, border-color 0.12s;
        box-shadow: 0 8px 26px rgba(0, 0, 0, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      .cell::after {
        content: "";
        position: absolute;
        inset: -4px;
        border-radius: 12px;
        z-index: 0;
        pointer-events: none;
        box-shadow: 0 0 8px rgba(var(--neon-purple), 0.06),
          0 0 18px rgba(var(--neon-pink), 0.03);
        filter: blur(6px);
        transition: box-shadow 0.18s ease, transform 0.18s ease;
        animation: neonCycle 6s infinite linear;
      }
      @keyframes neonCycle {
        0% {
          box-shadow: 0 0 8px rgba(var(--neon-purple), 0.1),
            0 0 14px rgba(var(--neon-pink), 0.03);
        }
        33% {
          box-shadow: 0 0 10px rgba(var(--neon-pink), 0.1),
            0 0 18px rgba(var(--neon-teal), 0.03);
        }
        66% {
          box-shadow: 0 0 12px rgba(var(--neon-teal), 0.12),
            0 0 20px rgba(var(--neon-purple), 0.04);
        }
        100% {
          box-shadow: 0 0 8px rgba(var(--neon-purple), 0.1),
            0 0 14px rgba(var(--neon-pink), 0.03);
        }
      }

      .cell.revealed {
        transform: translateY(-6px) scale(1.03);
        z-index: 3;
        box-shadow: 0 26px 60px rgba(0, 0, 0, 0.6);
      }
      .cell.revealed::after {
        box-shadow: 0 0 26px rgba(var(--neon-purple), 0.6),
          0 0 46px rgba(var(--neon-pink), 0.45),
          0 0 72px rgba(var(--neon-teal), 0.3);
        filter: blur(8px);
      }
      .cell .ch {
        position: relative;
        z-index: 2;
        text-shadow: 0 8px 18px rgba(0, 0, 0, 0.6);
        color: #fff;
      }

      .message {
        width: 100%;
        max-width: 360px;
        text-align: left;
        padding: 12px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.01),
          rgba(255, 255, 255, 0.008)
        );
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.55);
        color: #cceee3;
        font-weight: 700;
        z-index: 2;
      }
      .hint {
        font-size: 0.98rem;
        color: #cfeee3;
        margin-bottom: 12px;
        line-height: 1.45;
      }

      /* confetti pieces (DOM) */
      .confetti {
        position: fixed;
        pointer-events: none;
        z-index: 9999;
        border-radius: 3px;
        animation-name: confettiFall;
        animation-timing-function: cubic-bezier(0.2, 0.8, 0.2, 1);
        animation-fill-mode: both;
      }
      @keyframes confettiFall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(110vh) rotate(720deg);
          opacity: 0;
        }
      }

      footer {
        color: #9fd9cb;
        opacity: 0.9;
        margin-top: 6px;
        z-index: 2;
      }

      @media (max-width: 980px) {
        .stage {
          flex-direction: column;
          align-items: center;
        }
        .grid-card {
          width: 86vw;
          height: 86vw;
          max-width: 560px;
          max-height: 560px;
        }
        header {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <!-- animated background canvas (particles/wave) -->
    <canvas id="bgCanvas" class="bg-canvas" aria-hidden="true"></canvas>
    <div class="grain" aria-hidden="true"></div>

    <header>
      <div class="left">
        <h1>Level 3 — Crossword Hunt</h1>
        <div class="subtitle">
          8×8 grid — எவ்வளவு சொற்கள் மறைத்து உள்ளன என்று கணித்து வெல்லுங்கள்
        </div>
      </div>

      <div class="controls">
        <div class="counter" title="Guess count (0–10)">
          <button id="decBtn" aria-label="decrease">−</button>
          <div class="value" id="guessValue">0</div>
          <button id="incBtn" aria-label="increase">+</button>
        </div>
        <button class="check-btn" id="submitGuess">சரிபார்</button>
      </div>
    </header>

    <main class="stage">
      <div class="grid-card" aria-hidden="false">
        <div class="grid" id="grid"></div>
      </div>

      <div class="message" aria-live="polite">
        <div class="hint" id="hintBox">
          ஒரு எண்ணைக் செருகவும் (0–10). நீங்கள் நினைக்கும் எண்ணை சரிபார்க்கவும்.
          சரியானால் — "வாழ்த்துகள்! வாழ்த்துகள்!" தோன்றும்.
        </div>
        <div
          style="
            font-weight: 900;
            color: rgb(var(--neon-teal));
            margin-bottom: 8px;
          "
        >
          எடுத்துக்காட்டு செயல்முறை
        </div>
        <ul
          style="
            margin: 0;
            padding-left: 18px;
            color: #bfeee0;
            line-height: 1.6;
          "
        >
          <li>🔊 Grid ஐ கவனமாகப் பார்க்கவும்.</li>
          <li>🔢 counter மூலம் நீங்கள் நினைக்கும் எண்ணை தேர்வு செய்யவும்.</li>
          <li>✅ "சரிபார்" அழுத்தவும் — சரியானால் பரிசு வரும்!</li>
        </ul>
      </div>
    </main>

    <footer>Made with ❤ — Kid-friendly, neon style</footer>

    <!-- success overlay -->
    <div
      class="overlay"
      id="overlay"
      style="
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.18s;
      "
    >
      <div
        class="card"
        style="
          background: linear-gradient(135deg, #fff4, #ffd6);
          color: #111;
          padding: 28px 32px;
          border-radius: 18px;
          text-align: center;
          transform: translateY(-8px);
          box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        "
      >
        <h2 style="margin: 0; font-size: 2.4rem; color: rgb(var(--neon-pink))">
          வாழ்த்துகள்! 🎉
        </h2>
        <p style="margin-top: 8px; font-weight: 800">
          உன்னால் சரியாக கணித்தாய் — நன்றி!
        </p>
      </div>
    </div>

    <audio
      id="yayAudio"
      src="https://cdn.pixabay.com/download/audio/2023/03/30/audio_140921_cartoon-yay.mp3?filename=cartoon-yay-140921.mp3"
      preload="auto"
    ></audio>

    <!-- ======= JS (Behavior) ======= -->
    <script>
      /* ---------- Constants & state ---------- */
      const GRID_SIZE = 8;
      const WORD_BANK = [
        "அம்மா",
        "அப்பா",
        "வீடு",
        "பால்",
        "மழை",
        "பறவை",
        "காற்று",
        "பூ",
        "கண்",
        "நிலா",
      ];
      const TARGET_MIN = 3,
        TARGET_MAX = 10;

      let targetCount =
        Math.floor(Math.random() * (TARGET_MAX - TARGET_MIN + 1)) + TARGET_MIN;
      let grid = [];
      let placedWords = [];
      let availableWords = [];
      let actualPlacedCount = 0;

      let guess = 0;

      /* DOM refs */
      const gridEl = document.getElementById("grid");
      const guessValueEl = document.getElementById("guessValue");
      const incBtn = document.getElementById("incBtn");
      const decBtn = document.getElementById("decBtn");
      const submitBtn = document.getElementById("submitGuess");
      const overlay = document.getElementById("overlay");
      const yayAudio = document.getElementById("yayAudio");
      const hintBox = document.getElementById("hintBox");
      const bgCanvas = document.getElementById("bgCanvas");

      guessValueEl.textContent = guess;

      /* ---------- Grid helpers ---------- */
      function initGrid() {
        grid = new Array(GRID_SIZE);
        for (let r = 0; r < GRID_SIZE; r++)
          grid[r] = new Array(GRID_SIZE).fill(null);
      }

      function canPlace(chars, row, col, dir) {
        const len = chars.length;
        if (dir === "H") {
          if (col + len > GRID_SIZE) return false;
          for (let i = 0; i < len; i++) {
            const cell = grid[row][col + i];
            if (cell !== null && cell !== chars[i]) return false;
          }
          return true;
        } else {
          if (row + len > GRID_SIZE) return false;
          for (let i = 0; i < len; i++) {
            const cell = grid[row + i][col];
            if (cell !== null && cell !== chars[i]) return false;
          }
          return true;
        }
      }

      function placeWord(chars, row, col, dir) {
        const len = chars.length;
        if (dir === "H")
          for (let i = 0; i < len; i++) grid[row][col + i] = chars[i];
        else for (let i = 0; i < len; i++) grid[row + i][col] = chars[i];
      }

      function fillEmpty() {
        const FILLER = [
          "அ",
          "ஆ",
          "இ",
          "ஈ",
          "உ",
          "ஊ",
          "எ",
          "ஏ",
          "ஐ",
          "ஒ",
          "ஓ",
          "ஔ",
          "க்",
          "ங",
          "ச",
          "ஞ",
          "ட",
          "ண",
          "த",
          "ந",
          "ப",
          "ம",
          "ய",
          "ர",
          "ல",
          "வ",
          "ழ",
          "ள",
          "ஷ",
        ];
        for (let r = 0; r < GRID_SIZE; r++) {
          for (let c = 0; c < GRID_SIZE; c++) {
            if (grid[r][c] === null) {
              const ch = FILLER[Math.floor(Math.random() * FILLER.length)];
              // use full char (Array.from safe for multi-code-unit strings)
              grid[r][c] = Array.from(ch)[0];
            }
          }
        }
      }

      function shuffleArray(a) {
        const arr = a.slice();
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function placeRandomWords() {
        placedWords = [];
        actualPlacedCount = 0;
        initGrid();
        let pool = shuffleArray(WORD_BANK.slice());
        availableWords = pool.slice(0, Math.min(pool.length, 12));
        let attempts = 0;
        const maxAttempts = 5000;
        let i = 0;
        while (
          actualPlacedCount < targetCount &&
          attempts < maxAttempts &&
          i < availableWords.length
        ) {
          const word = availableWords[i];
          const chars = Array.from(word);
          for (let t = 0; t < 200; t++) {
            const dir = Math.random() < 0.55 ? "H" : "V";
            const row = Math.floor(Math.random() * GRID_SIZE);
            const col = Math.floor(Math.random() * GRID_SIZE);
            if (canPlace(chars, row, col, dir)) {
              placeWord(chars, row, col, dir);
              placedWords.push({ word, row, col, dir });
              actualPlacedCount++;
              break;
            }
          }
          attempts++;
          i++;
          if (i >= availableWords.length && actualPlacedCount < targetCount) {
            const remaining = WORD_BANK.filter(
              (w) => !availableWords.includes(w)
            );
            if (remaining.length === 0) break;
            const extra = shuffleArray(remaining);
            availableWords = availableWords.concat(
              extra.slice(0, Math.min(extra.length, 5))
            );
          }
        }
        fillEmpty();
      }

      /* render grid cells */
      function renderGrid() {
        gridEl.innerHTML = "";
        for (let r = 0; r < GRID_SIZE; r++) {
          for (let c = 0; c < GRID_SIZE; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.r = r;
            cell.dataset.c = c;
            const ch = document.createElement("div");
            ch.className = "ch";
            ch.textContent = grid[r][c] || "";
            cell.appendChild(ch);
            cell.addEventListener("mouseenter", () =>
              cell.classList.add("revealed")
            );
            cell.addEventListener("mouseleave", () =>
              cell.classList.remove("revealed")
            );
            gridEl.appendChild(cell);
          }
        }
      }

      /* ---------- UI controls ---------- */
      incBtn.addEventListener("click", () => {
        if (guess < 10) guess++;
        guessValueEl.textContent = guess;
      });
      decBtn.addEventListener("click", () => {
        if (guess > 0) guess--;
        guessValueEl.textContent = guess;
      });

      submitBtn.addEventListener("click", () => {
        if (guess === actualPlacedCount) {
          showOverlay();
          // when Level 3 is completed
          localStorage.setItem("level3Completed", "true");
          window.location.href = "home.html"; // back to home
        } else {
          hintBox.textContent = `தயவுசெய்து மீண்டும் முயற்சி செய் — நீங்கள் எடுத்துக் கொண்டது: ${guess} — உண்மையில் உள்ளன: ${actualPlacedCount}.`;
          setTimeout(() => {
            hintBox.innerHTML =
              "ஒரு எண்ணைக் செருகவும் (0–10). நீங்கள் நினைக்கும் எண்ணை சரிபார்க்கவும்.";
          }, 3000);
        }
      });

      function showOverlay() {
        overlay.style.pointerEvents = "auto";
        overlay.style.opacity = "1";
        try {
          yayAudio.currentTime = 0;
          yayAudio.play();
        } catch (e) {}
        burstConfetti(140);
        setTimeout(() => {
          overlay.style.opacity = "0";
          overlay.style.pointerEvents = "none";
          startRound();
        }, 3800);
      }

      /* ---------- Confetti (DOM pieces) ---------- */
      function burstConfetti(amount = 60) {
        const colors = [
          "#ffd54f",
          "#ff80ab",
          "#8c9eff",
          "#69f0ae",
          "#ff8a65",
          "#b39ddb",
          "#80deea",
        ];
        for (let i = 0; i < amount; i++) {
          const p = document.createElement("div");
          p.className = "confetti";
          const left = Math.random() * 100;
          p.style.left = `${left}vw`;
          p.style.background =
            colors[Math.floor(Math.random() * colors.length)];
          p.style.width = `${Math.random() * 10 + 6}px`;
          p.style.height = `${Math.random() * 10 + 6}px`;
          p.style.top = `${-Math.random() * 50 - 10}px`;
          p.style.zIndex = 9999;
          p.style.position = "fixed";
          p.style.transform = `rotate(${Math.random() * 360}deg)`;
          const dur = Math.random() * 2.5 + 2.2;
          // small random delay to spread them out
          const delay = Math.random() * 0.35;
          p.style.animationDuration = `${dur}s`;
          p.style.animationDelay = `${delay}s`;
          // append and remove after animation finishes
          document.body.appendChild(p);
          setTimeout(() => p.remove(), (dur + delay + 0.2) * 1000);
        }
      }

      /* ---------- Background canvas (particles + slow wave) ---------- */
      (function backgroundParticles() {
        const canvas = bgCanvas;
        const ctx = canvas.getContext("2d");
        let w = (canvas.width = innerWidth),
          h = (canvas.height = innerHeight);
        let particles = [];
        function rand(min, max) {
          return Math.random() * (max - min) + min;
        }
        function init() {
          particles = [];
          const PCOUNT = Math.max(12, Math.round(Math.min(w, h) / 40));
          for (let i = 0; i < PCOUNT; i++) {
            particles.push({
              x: rand(0, w),
              y: rand(0, h),
              r: rand(0.6, 2.2),
              vx: rand(-0.2, 0.2),
              vy: rand(0.05, 0.25),
              hue: rand(220, 320) | 0,
              alpha: rand(0.06, 0.18),
            });
          }
        }
        function resize() {
          w = canvas.width = innerWidth;
          h = canvas.height = innerHeight;
          init();
        }
        window.addEventListener("resize", resize);
        init();

        let t0 = 0;
        (function frame(ts) {
          const dt = (ts - t0) * 0.001 || 0.016;
          t0 = ts;
          ctx.clearRect(0, 0, w, h);
          const g = ctx.createLinearGradient(0, 0, w, h);
          g.addColorStop(0, "rgba(18,10,28,0.06)");
          g.addColorStop(1, "rgba(2,8,18,0.06)");
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, w, h);

          ctx.globalCompositeOperation = "lighter";
          for (let p of particles) {
            p.x += p.vx * (1 + Math.sin(ts * 0.0002 + p.r));
            p.y += p.vy * (1 + Math.cos(ts * 0.0001 + p.r));
            if (p.y > h + 20) {
              p.y = -10;
              p.x = rand(0, w);
            }
            ctx.beginPath();
            ctx.fillStyle = `hsla(${p.hue}, 60%, 60%, ${p.alpha})`;
            ctx.arc(
              p.x,
              p.y + Math.sin((p.x + ts * 0.02) / 120) * 6,
              p.r,
              0,
              Math.PI * 2
            );
            ctx.fill();
          }
          ctx.globalCompositeOperation = "source-over";
          requestAnimationFrame(frame);
        })(0);
      })();

      /* ---------- Init round & flow ---------- */
      function startRound() {
        targetCount =
          Math.floor(Math.random() * (TARGET_MAX - TARGET_MIN + 1)) +
          TARGET_MIN;
        placeRandomWords();
        renderGrid();
        guess = 0;
        guessValueEl.textContent = guess;
        // brief helper showing actual placed count (optional)
        hintBox.innerHTML = `இந்த ஆட்டத்தில் மறைக் சொற்களின் எண்ணிக்கை (உள்ளே): <strong>${actualPlacedCount}</strong>`;
        setTimeout(() => {
          hintBox.innerHTML =
            "ஒரு எண்ணைக் செருகவும் (0–10). நீங்கள் நினைக்கும் எண்ணை சரிபார்க்கவும்.";
        }, 2200);
      }

      /* Helpers reused above (already defined earlier) */
      // placeRandomWords defined earlier.

      /* start the first round */
      startRound();

      /* expose for debugging (optional) */
      window._level3 = { startRound, placedWords, actualPlacedCount };
    </script>
  </body>
</html>
